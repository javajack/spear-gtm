---
title: "System Design"
description: "Full system architecture diagram showing how frontend, backend, AI layer, data providers, and email infrastructure connect."
---

Here's how all the pieces fit together — the blueprint for how Spear works under the hood. From the dashboard you interact with, through the Go backend and NATS job queue, down to the email infrastructure that delivers your outreach.

## Architecture Overview

```mermaid
graph TB
    subgraph Frontend["Frontend — Next.js 14 on AWS Amplify"]
        UI[Dashboard UI<br/>Tailwind + shadcn/ui]
        Auth[Auth Flow<br/>Google OAuth]
        Review[Email Review<br/>One-click approve]
    end

    subgraph Backend["Backend — Go on ECS Fargate"]
        API[Go API Server<br/>chi/echo router]
        TenantMW[Tenant Middleware<br/>JWT → tenant scope]
        DB[(RDS PostgreSQL<br/>Schema-per-tenant<br/>+ Row-Level Security)]
        AuthSvc[JWT Auth Layer<br/>Google OAuth tokens]
    end

    subgraph Queue["Job Queue — NATS JetStream (Fargate sidecar)"]
        Research[Prospect Research<br/>Durable consumer]
        Generate[Email Generation<br/>Durable consumer]
        Send[Send Scheduling<br/>Durable consumer]
        Reply[Reply Processing<br/>Durable consumer]
    end

    subgraph AI["AI Layer — Claude Sonnet 4.6"]
        ICP[ICP Analysis<br/>Product → persona]
        Score[Prospect Scoring<br/>1-100 + reasoning]
        Write[Email Generation<br/>Voice-matched]
        Classify[Reply Classification<br/>Intent detection]
    end

    subgraph Data["Data Providers"]
        Apollo[Apollo.io API<br/>Prospect + email data]
        LinkedIn[LinkedIn<br/>Proxied search]
        GitHub[GitHub API<br/>Dev tool companies]
        PH[Product Hunt<br/>Startup prospects]
    end

    subgraph Email["Email Infrastructure"]
        Resend[Resend / Amazon SES<br/>Sending]
        Gmail[Gmail OAuth<br/>Reply reading]
        Outlook[Outlook OAuth<br/>Reply reading]
        Domain[Cloudflare<br/>SPF/DKIM/DMARC]
    end

    UI --> API
    Auth --> AuthSvc
    API --> TenantMW
    TenantMW --> DB
    API --> Queue

    Research --> AI
    Research --> Data
    Generate --> AI
    Send --> Email
    Reply --> AI
    Reply --> Gmail
    Reply --> Outlook

    style Frontend fill:#064e3b,color:#fff
    style Backend fill:#064e3b,color:#fff
    style AI fill:#059669,color:#fff
    style Queue fill:#064e3b,color:#fff
```

## Data Flow

```mermaid
sequenceDiagram
    participant F as Founder
    participant UI as Dashboard
    participant API as Go API
    participant Q as NATS JetStream
    participant AI as Claude AI
    participant D as Apollo/Data
    participant E as Email (Resend/SES)
    participant G as Gmail

    F->>UI: Paste product URL + describe ICP
    UI->>API: Create campaign
    API->>Q: Publish to PROSPECTS stream
    Q->>AI: Analyze product → ICP profile
    Q->>D: Search prospects matching ICP
    D-->>Q: Raw prospect data
    Q->>AI: Score each prospect (1-100)
    Q->>AI: Generate 3-email sequence per prospect
    Q-->>API: Research complete
    API-->>UI: Show 25 prospects with drafts

    F->>UI: Approve 10 prospects (one click)
    UI->>API: Queue approved sends
    API->>Q: Publish to EMAILS stream
    Q->>E: Send email (throttled, timed)
    E-->>Q: Delivery confirmed

    G-->>Q: Reply detected (via REPLIES stream)
    Q->>AI: Classify reply intent
    AI-->>Q: "Interested" + draft response
    Q-->>API: Notify founder
    API-->>UI: Show reply + suggested response
    F->>UI: Approve response (one click)
    UI->>API: Send response
    API->>E: Send reply with calendar link
```

## Infrastructure Cost at Scale

| Scale | Infra (AWS + services) | AI Costs | Data Costs | Total COGS | Gross Margin |
|-------|-------|----------|------------|-----------|-------------|
| Launch (10 customers) | $150/mo | $50/mo | $50/mo | ~$250/mo | ~45% |
| 100 customers | $600/mo | $4,000/mo | $3,000/mo | ~$10,600/mo | **76%** |
| 1,000 customers | $4,000/mo | $30,000/mo | $20,000/mo | ~$76,000/mo | **84%** |
| 10,000 customers | $20,000/mo | $200,000/mo | $150,000/mo | ~$635,000/mo | **88%** |
